{% extends 'layout.html' %}

{% block right_sidebar_button %}
<a id="sidr-right-top-button" class="menu-button right" href="#sidr-right-top">Toggle menu</a>
{% endblock %}

{% block right_sidebar %}
<div id="sidr-right-top">
    <form action="{{ url_for('ranking') }}" method="post" class="form-inline">
      <ul>
        <li>
          時間区分：
            <select name="filter_outline" id="filter_outline" class="form-control">
              {% for outline in outline_list %}
                <option value="{{ outline.outline_id }}">{{ outline.date }} {{ outline.time_category }}</option>
              {% endfor %}
            </select>
        </li>

      </ul>

      <button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> フィルター
      </button>
    </form>
</div>
{% endblock %}


{% block content %}
  <h2>{{ outline_name }}</h2>

  <h3 class="h3">MAXスピードランキング(knot)</h3>
    <script src="{{ url_for('static', filename='js/Chart.bundle.js') }}"></script>
    <canvas id="myChart" width="400" height="250"></canvas>
    <script>
        var max_speed = {{ rank_values.speed | tojson }};
        var labels = {{ rank_values.label | tojson }};
            // 縦軸ラベル
        var datalabels = labels;
        // データ
        var data = {
          // X軸のラベル
          labels: datalabels,
          datasets: [{
            // 線の太さを指定(px)
            borderWidth: 1,
            hoverBorderWidth:100, // ホバー時の枠線の太さ
            label: "最高スピード(knot)", // 凡例とツールチップに表示するデータセットのラベル
            // 背景色指定(各グラフ毎)
            backgroundColor: [
                'rgba(54, 162, 235, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(54, 162, 235, 0.5)',
            ],
            //棒グラフの外枠線の色指定(グラフ毎)
            borderColor: [
                'rgba(54, 162, 235, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(54, 162, 235, 1)',
            ],
            //グラフの数値
            data: max_speed,
          }]
        };

        var option = {
          plugins: {
            filler: {
              propagate: true
            }
          },
          // animation: {
          //   duration: 1, // アニメーションストップ
          // },
          // legend: {
          //   position:'top',//ラベル上表示
          // },
          // 目盛の設定
          scales: {
            // 横軸の設定
            xAxes: [{
              ticks: { // 目盛の設定
                min: 0, // Y軸の最大値
                max: Math.round(Math.max.apply(null, max_speed))+1, // Y軸の最小値
                beginAtZero: true,
                type: "time",
                time: {
                  unit: 'minute',
                  displayFormat: 'HH:mm',
                },
              },
              // グリッド線の設定
              gridLines:{
                drawBorder:false,
                lineWidth:1,
              },
            }],
            //縦軸の設定
            yAxes: [{
              barThickness:15,  //各バーの幅
              ticks: {
                beginAtZero: true, //開始値を0にする
                fontSize: 10,       //フォントサイズ
                maxRotation: 0,  // 最大角度
                minRotation: 0, // 斜めに表示
              },
            }],
          },
        };

        // Define a plugin to provide data labels
        Chart.plugins.register({
            afterDatasetsDraw: function (chart, easing) {
                // To only draw at the end of animation, check for easing === 1
                var ctx = chart.ctx;

                chart.data.datasets.forEach(function (dataset, i) {
                    var meta = chart.getDatasetMeta(i);
                    if (!meta.hidden) {
                        meta.data.forEach(function (element, index) {
                            // Draw the text in black, with the specified font
                            ctx.fillStyle = 'rgb(10, 10, 10)';

                            var fontSize = 16;
                            var fontStyle = 'normal';
                            var fontFamily = 'Helvetica Neue';
                            ctx.font = Chart.helpers.fontString(fontSize, fontStyle, fontFamily);

                            // Just naively convert to string for now
                            var dataString = dataset.data[index].toString();

                            // Make sure alignment settings are correct
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';

                            var padding = 5;
                            var position = element.tooltipPosition();
                            ctx.fillText(dataString, position.x, position.y - (fontSize / 2) - padding);
                        });
                    }
                });
            }
        });

        // グラフ出力
        var ctx = document.getElementById('myChart');
        new Chart(ctx, {
          type: 'horizontalBar',
          data: data,
          options: option,
        });
    </script>

{% endblock %}